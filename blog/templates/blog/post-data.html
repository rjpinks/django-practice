{% extends 'blog/base.html' %}

{% block style %}
{% load static %}
<link rel="stylesheet" href="{% static 'blog/post-data.css' %}">
{% endblock %}

{% block content %}
<div id="post-data-master">
	<h2 id="post-title">{{ post.title }}</h2>
	{% if post.image_address %}
		<img id="post-image" src="{{ post.image_address }}" alt="cool artwork or image associated with the article">
	{% endif %}
	{% if post.content %}
		<section id="post-section">
			<p id="post-content">{{ post.content }}</p>
		</section>
	{% endif %}
	{% if comments and user.is_authenticated %}
		<div id="button-container">
			<button id="see-comments">See Comments</button>
			<div id="blackbar"></div>
			<button id="add-comment-btn">Add Comment</button>
		</div>
		<script>
			// display comments
			const commentBtn = document.querySelector('#see-comments')
			commentBtn.addEventListener('click', (e) => {
				const commentSection = document.querySelector('#comments-container')
				commentSection.style.display = 'block'
			})
			// display Add Comment form
			const commentFormBtn = document.querySelector('#add-comment-btn')
			commentFormBtn.addEventListener('click', (e) => {
				const commentFormContainer = document.querySelector(
					'#comment-form-container')
				commentFormContainer.style.display = 'block'
			})

			// hide Add Comment form
			const cancelFormBtn = document.querySelector('#cancel-form-button')
			cancelFormBtn.addEventListener('click', (e) => {
				const commentFormContainer = document.querySelector('#comment-form-container')
				commentFormContainer.style.display = null
			})
		</script>
	{% elif comments and not user.is_authenticated %}
		<div id="button-container">
			<button id="see-comments">See Comments</button>
			<div id="blackbar"></div>
			<a id="add-comment" href="{% url 'login' %}">Add Comment</a>
		</div>
		<script>
			// display comments
			const commentBtn = document.querySelector('#see-comments')
			commentBtn.addEventListener('click', (e) => {
				const commentSection = document.querySelector('#comments-container')
				commentSection.style.display = 'block'
			})
		</script>
	{% elif not comments and user.is_authenticated %}
		<div id="button-container">
			<button id="add-comment-btn">Add Comment</button>
			<script>
				// display Add Comment form
				const commentFormBtn = document.querySelector('#add-comment-btn')
				commentFormBtn.addEventListener('click', (e) => {
					const commentFormContainer = document.querySelector('#comment-form-container')
					commentFormContainer.style.display = 'block'
				})

				// hide Add Comment form
				const cancelFormBtn = document.querySelector('#cancel-form-button')
				cancelFormBtn.addEventListener('click', (e) => {
					const commentFormContainer = document.querySelector('#comment-form-container')
					commentFormContainer.style.display = null
				})
			</script>
		</div>
	{% else %}
		<div id="button-container">
			<a id="add-comment" href="{% url 'login' %}">Add Comment</a>
		</div>
	{% endif %}
</div>

<br>

{% if user.is_authenticated %}
<div id="comment-form-container">
	<form id="comment-form" action="{% url 'comment_form' %}" method="POST">
		{% csrf_token %}
		<input type="hidden" name="parent-post" value="{{ post.id }}">
		<input type="hidden" name="author-id" value="{{ user.id }}">

		<div style="margin-top: 4px;" class="field">
		  <label class="label comment-label">Message</label>
		  <div class="control">
		    <textarea name="comment" class="textarea comment-input" placeholder="Place a message here!"></textarea>
		  </div>
		</div>

		<div class="field is-grouped">
		  <div class="control">
		    <input style="margin-left: 4px; background-color: #ffff99;" class="button" type="submit" value="Submit">
		  </div>
		  <div class="control">
		    <button
		    	id="cancel-form-button"
		    	class="button"
		    	style="background-color: #ff9999;"
		    >Cancel</button>
		  </div>
		</div>

	</form>
</div>
{% endif %}

{% if comments %}
	<br>
	<div id="comments-container">
		<h2 id="comments-header">Comments</h2>
		<div id="comment-container">
			{% for comment in comments %}
				<section id="comment-{{ comment.id }}" class="comment-section">
					<p class="comment-author"><strong>Written by: {{ comment.author.display_name }}</strong></p>
					<p class="comment-content">{{ comment.content }}</p>
					<p class="comment-date"><em>{{ comment.date_pub }}</em></p>
				</section>
			{% endfor %}
			<section id="see-more-sec">
				<button id="see-more-btn">See more</button>
			</section>
		</div>
	</div>
	<script src="{% static 'blog/loadComments.js' %}"></script>
{% endif %}
<br>
{% endblock %}
